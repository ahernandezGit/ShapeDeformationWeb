<!DOCTYPE html>
<!-- saved from url=(0132)file:///media/Montado/Academico/Computacion%20Cientifica/CompuGrafica/Modelagem%20Geometrica/testes/testes/test1%20(c%C3%B3pia).html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta charset="utf-8">
	<style>
		canvas { width: 100%; height: 100% }
        .overcanvas {
				position: absolute;
				top: 0px;
				width: 150px;
				padding: 5px;
				font-family: Monospace;
				font-size: 13px;
				text-align: left;
				font-weight: bold;
        }
        .stepbystep{
            border: 1px black solid;
            padding-left: 5px;
        }
	</style>
    
	<script src="libs/three.js"></script>
	<script src="libs/TrackballControls.js"></script>
	<script src="libs/ThreeSetup.js"></script>
    <script src="libs/GridMesh2D.js"></script>
    <script src="libs/GridMesh3D.js"></script>
    <script src="libs/hemesh.js"></script>
    <script src="libs/numeric-1.2.6.js"></script>
	 <!--<script src="libs/models.js"></script>
     <script src="libs/requestAnimationFrame.js"></script>
     <script src="libs/halfedge.js"></script> 
     <script src="libs/papermodel.js"></script> 
     <script src="libs/pvector.js"></script> 
     
     <button id="holesButton" disabled="disabled">Holes</button>
      -->
    <script src="libs/d3.min.js"></script>
    <script src="libs/doubly-linked-list.js"></script>    
    <script src="libs/victor.min.js"></script> 
 
    
    
	</head>
	<body>
        <div class="overcanvas"><br>
        <label>Size of the Grid <input id="sizeGridBar" type="range" value="0.1" min="0.05" max="0.5" step="0.01" onchange="updateSizeGrid(this.value)"></label><br/>
        <label id="valueexample"> </label><br>
        <label><input type="checkbox" id="checkWireframe">Wireframe </label><br/><br/>
             
        <input type="radio" name="gender" id="radioSBS" checked> Step by step <br/>
        <div id="buttonsSBS" class="stepbystep">
            <p>
            <label><input type="checkbox" id="checkGrid">Grid</label><br/>        
            <button id="opButton">Optimize Boundary </button>
            <button id="fixButton"> Fix Boundary </button>       
            <button id="reflexButton">Step by Step </button>
            <button id="assoButton">Associated</button>
            <button id="inflationButton">Inflation</button>     
            <button id="drawButton">Draw</button>    
            <button id="clearButton">Clear </button>
            <button id="finishButton">Finish</button>    
            </p>
        </div>
        <input type="radio" name="gender" id="radioFibermesh"> Fibermesh mode <br/>  
     
        </div>
	<script>
        var requestIdAnimation;
        var mouse = new THREE.Vector2();
        var sqrt3=1.732050808;
        var setup = new ThreeSetup();
        var cancelRender=false;
        var isDrawing=false;
        var LastPoint,CurrentPoint;
        var sizeGrid=document.getElementById("sizeGridBar").value;
        console.log(sizeGrid);
        var LineSample = new THREE.Object3D();
        var LineStroke = new THREE.Object3D();
        var gridgeometry = new THREE.Object3D();
        var checkGrid=document.getElementById("checkGrid");
        gridgeometry.name="Grid2D";
        LineSample.name="LineSample";
        materialReal = new THREE.LineBasicMaterial( { color: 0xff0000, linewidth: 2 } );
        materialSample = new THREE.LineBasicMaterial( { color: 0x0015FF, linewidth: 2 } );
        materialGrid2D = new THREE.LineBasicMaterial( { color: 0xff2222, linewidth: 1 } );
        materialBoundaryGrid = new THREE.LineBasicMaterial( { color: 0x27B327, linewidth: 2 });
        
        var width,height,starx,stary;   
        var points = [ ], pointSample = [ ];
        //array of grid points
        var gridPointsArray=[];
        //array of i values from the grid
        var gridI=[];
        
        var gridBoundary=[];
        var gridInterior=[];
        //var hemesh = new Hemesh();
        var GridMeshVertexArray=[];
        var GridMeshFacesArray=[];
        //store index on GridMeshVertexArray of the index in GridPointArray
        var TableHashIndextoPosition=[];
        //store index on GridMeshFacesArray of the index in GridMeshVertexArray
        var TableHashVertextoFace=[];
        var ptd=[];
        
        // mode of the application
        var mode="sbs";
        
        function mousePosition3D(event){
            // calculate mouse position in normalized device coordinates
            // (-1 to +1) for both components
            mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
            mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;		
            //console.log(mouse);
            var vector = new THREE.Vector3();
            vector.set( mouse.x ,mouse.y , 0.5 );
           // console.log("vector antes ", vector);
            vector.unproject( setup.camera);
           // console.log("vector depois ", vector);
            var dir = vector.sub( setup.camera.position ).normalize();
            //console.log("direcao ", dir);  
            var distance = - setup.camera.position.z / dir.z;
            //console.log("distancia ", distance); 
            var pos = setup.camera.position.clone().add( dir.multiplyScalar( distance ) );
            //console.log(pos);   
            return pos;
        }
        function onMouseMove() {
            event=d3.event;
            if (!isDrawing) return;
            CurrentPoint=mousePosition3D(event);
            points.push(CurrentPoint);
            //console.log(points);
            var geometryLine = new THREE.Geometry();
            geometryLine.vertices.push(LastPoint,CurrentPoint);
            LastPoint=CurrentPoint;
            var line = new THREE.Line( geometryLine, materialReal );
            LineStroke.add(line);
            //setup.scene.add( line );
        }
        function onMouseDown () {
            clearScene();
            event=d3.event;
            isDrawing = true;
            setup.scene.add(LineStroke);
            LastPoint=mousePosition3D(event);
            points.push(LastPoint);  
            //render();
        }
    
        function onMouseUp () {
             event=d3.event;
             isDrawing = false;
             //console.log(points);
             Resample(points);
             setup.scene.remove( LineStroke );
             createGrid();
             drawGrid(true);
             GrowingFeed();
             ptd=MappingVerteToStroke();
             console.log(ptd);
             drawAssociated();  
             if(mode=="fiber"){
               fixBoundaryPoints();    
               inflationFuntion();
               OtherMouseControls();     
             }
             drawBoundary(gridBoundary);
             cancelRender=false;
             render();
        }
        
        function clearScene(){
             for( var i = setup.scene.children.length - 1; i >= 0; i--) { 
                 var  obj = setup.scene.children[i];
                 setup.scene.remove(obj);
             }
              points=[];
              pointSample = [ ];
              gridI=[];
              gridPointsArray=[];
              ptd=[];
              LineSample = new THREE.Object3D();
              LineStroke = new THREE.Object3D();
              gridgeometry = new THREE.Object3D();
              //hemesh=new Hemesh();
              gridBoundary=[];
              gridInterior=[];
              GridMeshVertexArray=[];
              GridMeshFacesArray=[];
              TableHashIndextoPosition=[];
              cancelRender=false;
              render();
         }
        
        window.addEventListener('resize', onWindowResize, false);
        function onWindowResize() {
            setup.resize();
        }

        function render() {
            if(!cancelRender){
                requestIdAnimation=requestAnimationFrame(render);
                setup.render();
            }
            else{
                cancelAnimationFrame(requestIdAnimation);
            }
        }
        function cancelAnimation(){
            cancelRender=true;
        }
        render();
        setTimeout(cancelAnimation,5000);
        var canvaswindows=d3.select("canvas");
        canvaswindows.on("mousedown",onMouseDown);
        canvaswindows.on("mouseup",onMouseUp);
        canvaswindows.on("mousemove",onMouseMove);
	</script><canvas width="646" height="645" style="width: 646px; height: 645px;"></canvas>
    <script src="libs/EventsOnTag.js"></script> 
	
</body></html>
